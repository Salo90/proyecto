{% extends "dashboard.html" %}

{% block title %}Productos · Salo Sport{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Productos</h2>

  <!-- Fila: Botón Nuevo + Búsqueda en una sola línea -->
  <div class="row g-3 align-items-end mb-4">
    <!-- Botón Nuevo -->
    <div class="col-md-3">
      <a href="{{ url_for('crear_producto') }}" class="btn btn-dark w-100">
        <i class="bi bi-plus-circle me-1"></i> Nuevo
      </a>
    </div>

    <!-- Formulario de búsqueda -->
    <div class="col-md-9">
      <form method="GET" action="{{ url_for('productos_list') }}" class="d-flex justify-content-end gap-2">
        <div class="input-group input-group-sm" style="max-width: 250px;">
          <span class="input-group-text bg-light">
            <i class="bi bi-search"></i>
          </span>
          <input
            type="text"
            name="q"
            class="form-control form-control-sm"
            placeholder="Buscar por nombre..."
            value="{{ request.args.get('q', '') }}"
          >
        </div>
        <button type="submit" class="btn btn-dark btn-sm px-3">
          <i class="bi bi-funnel me-1"></i> Filtrar
        </button>
      </form>
    </div>
  </div>

  <!-- Tabla responsive -->
  <div class="table-responsive shadow-sm rounded">
    <table class="table table-striped table-hover align-middle mb-0">
      <thead class="table-dark">
        <tr>
          <th scope="col">Código</th>
          <th scope="col">Nombre</th>
          <th scope="col">Descripción</th>
          <th scope="col">Categoría</th>
          <th scope="col">Stock</th>
          <th scope="col">Precio</th>
          <th scope="col" class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% if productos %}
          {% for p in productos %}
            <tr>
              <td>{{ p.codigo }}</td>
              <td>{{ p.nombre }}</td>
              <td>{{ p.descripcion }}</td>
              <td>{{ p['categoria'] if p['categoria'] else '—' }}</td>
              <td>
                <span class="badge bg-primary">{{ p.stock }}</span>
              </td>
              <td>
                <strong>${{ '%.2f'|format(p.precio_venta) }}</strong>
              </td>
              <td class="text-center">
                <div class="btn-group btn-group-sm" role="group">
                  <a href="{{ url_for('editar_producto', pid=p.idproducto) }}" 
                    class="btn btn-outline-dark btn-sm me-1">
                    <i class="bi bi-pencil-square"></i> Editar
                  </a>
                  <form method="POST" action="{{ url_for('eliminar_producto', pid=p.idproducto) }}" style="display: inline;">
                    <button type="submit" class="btn btn-outline-danger btn-sm"
                            onclick="return confirm('¿Eliminar producto? Esta acción no se puede deshacer.')">
                      <i class="bi bi-trash"></i> Eliminar
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="6" class="text-center text-muted fst-italic">
              {% if request.args.get('q') %}
                No se encontraron productos que coincidan con "<strong>{{ request.args.get('q') }}</strong>".
              {% else %}
                No hay productos registrados.
              {% endif %}
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}